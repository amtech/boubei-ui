"use strict";var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(a)throw i}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}!function(e){var t=function(){this.images=[],this.current=0,this.show=!1,this._dom,this._titleDOM,this._pagnationDOM,this.init()};function m(e,t){var r=document.createElement(e);return t&&(r.className=t),r}function d(e,t){var r=window.getComputedStyle(e,null).getPropertyValue("transform"),n=r.split("(")[1].split(")")[0].split(","),a=_slicedToArray(n,2),i=a[0],o=a[1],s=Math.round(Math.atan2(o,i)*(180/Math.PI));e.style="-webkit-transform:rotate("+(s+t)+"deg);transform:rotate("+(s+t)+"deg)"}function o(e){var t=e.dom,r=e.offset;t.scrollLeft+=r}t.prototype={constructor:t,mount:function(e){return e.appendChild(this._dom),this},showOnClick:function(e){var i=this;if(null!=e){for(var o=this._dom.getElementsByClassName("image-browser__image-swiper")[0];o.firstChild;)o.removeChild(o.firstChild);var t=[].concat(_toConsumableArray(e.getElementsByTagName("a"))).map(function(e,t){var r=e.getAttribute("href"),n=e.innerText;return e.setAttribute("href","javascript:void(0);"),e.dataset.url=r,e.dataset.index=t,{url:r,text:n}});this.insertImages(t),this.images=t,e.addEventListener("click",function(e){var t=e||window.event,r=t.target||t.srcElement;if("a"===r.nodeName.toLocaleLowerCase()){i.toggleClose();var n=+r.dataset.index;[(i.current=n)-1,n,n+1].forEach(function(e){var t=i.images[e];t&&"img"===t.dom.nodeName.toLocaleLowerCase()&&t.dom.setAttribute("src",t.url)}),o.scrollLeft=1e3*n,i._titleDOM.textContent=i.images[n].text,i._pagnationDOM.textContent=n+1+"/"+i.images.length;var a=i._dom.getElementsByClassName("image-browser__arrow-btn");0==n&&a[0].classList.add("image-browser__btn_disable"),n==i.images.length-1&&a[1].classList.add("image-browser__btn_disable")}},!1)}},toggleClose:function(){var e=this._dom;this.show?(this.show=!1,[].concat(_toConsumableArray(e.getElementsByClassName("image-browser__arrow-btn"))).forEach(function(e){return e.classList.remove("image-browser__btn_disable")}),e.classList.remove("image-browser__show"),this.current=0):(this.show=!0,e.classList.add("image-browser__show"))},lazyLoadImage:function(e){var t=this.images[e];if(null!=t){var r=t.url,n=t.dom;"img"===n.nodeName.toLocaleLowerCase()&&null===n.getAttribute("src")&&n.setAttribute("src",r)}},init:function(){var e=m("div","image-browser");e.appendChild(this.createToolbar()),e.appendChild(this.createImageNav());var t=m("div","image-browser__pagnation");t.textContent="0/0",this._pagnationDOM=e.appendChild(t),this._dom=e,this.mount(document.body);var r=document.getElementsByClassName("ext")[0];this.showOnClick(r)},createToolbar:function(){var i=this,t=m("div","image-browser__row image-browser__toolbar"),e=m("div","image-browser__toolbar-item image-browser__toolbar-item_left"),r=m("button","image-browser__btn");r.textContent="向左旋转",r.onclick=function(){d(i.images[i.current].dom,-90)},e.appendChild(r);var n=m("button","image-browser__btn");n.textContent="向右旋转",n.onclick=function(){d(i.images[i.current].dom,90)},e.appendChild(n);var a=m("div","image-browser__toolbar-item image-browser__toolbar-item_center"),o=m("div","image-browser__title");o.textContent="文件名",this._titleDOM=a.appendChild(o);var s=m("div","image-browser__toolbar-item image-browser__toolbar-item_right"),l=m("button","image-browser__btn");l.textContent="下载",l.onclick=function(){var e=i.images[i.current],n=e.text,t=e.url,a=new XMLHttpRequest;a.open("GET",t),a.responseType="blob",a.onload=function(e){var t=new Blob([a.response],{type:a.response.type}),r=new FileReader;r.onload=function(){var e=m("a");e.style.display="none",i._dom.appendChild(e),e.href=r.result,e.download=n,e.click(),i._dom.removeChild(e)},r.readAsDataURL(t)},a.send()},s.appendChild(l);var c=m("button","image-browser__btn image-browser__close-btn ion-ios-close-circle-outline");return c.onclick=this.toggleClose.bind(this),s.appendChild(c),[e,a,s].forEach(function(e){return t.appendChild(e)}),t},createImageNav:function(){var t=this,r=m("div","image-browser__row image-browser__image-nav"),n=m("div","image-browser__image-swiper"),e=function(e){var t=m("button","image-browser__btn image-browser__arrow-btn ion-ios-arrow-"+e);return t},a=e("back"),i=e("forward");return[a,n,i].forEach(function(e){return r.appendChild(e)}),a.onclick=function(){0!=t.current&&(i.classList.remove("image-browser__btn_disable"),o({dom:n,offset:-1e3}),t.current=t.current-1,t._titleDOM.textContent=t.images[t.current].text,t._pagnationDOM.textContent=t.current+1+"/"+t.images.length,t.lazyLoadImage(t.current-1),0==t.current&&a.classList.add("image-browser__btn_disable"))},i.onclick=function(){var e=t.images.length;t.current!=e-1&&(a.classList.remove("image-browser__btn_disable"),o({dom:n,offset:1e3}),t.current=t.current+1,t._titleDOM.textContent=t.images[t.current].text,t._pagnationDOM.textContent=t.current+1+"/"+e,t.lazyLoadImage(t.current+1),t.current==e-1&&i.classList.add("image-browser__btn_disable"))},r},createImgDOM:function(e){var t=e.src,r=e.index,n=m("img","image-browser__image");return n.setAttribute("alt",t),n.style="-webkit-transform:rotate(0);transform:rotate(0)",n.dataset.index=r,n},createUnknownFileTypeDOM:function(e){var t=m("div","image-browser__image-placeholder");return t.textContent="该文件不是图片，点击下载进行查看",t.dataset.index=e,t},insertImages:function(e){var i=this,o=this._dom.getElementsByClassName("image-browser__image-swiper")[0],s=["png","jpg","jpeg","gif","webp"];e.forEach(function(e,t){var r,n=s.includes((r=e.text,/[.]/.exec(r)?/[^.]+$/.exec(r)[0]:void 0).toLocaleLowerCase())?i.createImgDOM({src:e.url,index:t}):i.createUnknownFileTypeDOM(t),a=m("div","image-browser__image-wrapper");a.style.left=1e3*t+"px",a.appendChild(n),o.appendChild(a),e.dom=n})}};var r,n=(r=null,function(){return r||(r=new t)});e.init=n,e.showOnClick=function(e){n().showOnClick(e)}}(window.ImageBrowser={}),ImageBrowser.init();