"use strict";var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],a=!0,n=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(a=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);a=!0);}catch(e){n=!0,i=e}finally{try{!a&&s.return&&s.return()}finally{if(n)throw i}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}!function(e){var t=function(){this.images=[],this.current=0,this.show=!1,this._dom,this._titleDOM,this._pagnationDOM,this.init()};function d(e,t){var r=document.createElement(e);return t&&(r.className=t),r}function c(e,t){var r=window.getComputedStyle(e,null).getPropertyValue("transform"),a=r.split("(")[1].split(")")[0].split(","),n=_slicedToArray(a,2),i=n[0],o=n[1],s=Math.round(Math.atan2(o,i)*(180/Math.PI));e.style="-webkit-transform:rotate("+(s+t)+"deg);transform:rotate("+(s+t)+"deg)"}t.prototype={constructor:t,mount:function(e){return e.appendChild(this._dom),this},showOnClick:function(e){var o=this;if(null!=e){for(var s=this._dom.getElementsByClassName("image-browser__image-swiper")[0];s.firstChild;)s.removeChild(s.firstChild);var t=[].concat(_toConsumableArray(e.getElementsByTagName("a"))).map(function(e,t){var r=e.dataset.url||e.getAttribute("href"),a=e.innerText;return e.setAttribute("href","javascript:void(0);"),e.dataset.url=r,e.dataset.index=t,{url:r,text:a}});this.insertImages(t),this.images=t,e.addEventListener("click",function(e){var t=e||window.event,r=t.target||t.srcElement;if("a"===r.nodeName.toLocaleLowerCase()){o.toggleClose();var a=+r.dataset.index;o.current=a;var n=o.images.length;[(a-1+n)%n,a,(a+1)%n].forEach(function(e){var t=o.images[e];t&&"img"===t.dom.nodeName.toLocaleLowerCase()&&t.dom.setAttribute("src",t.url)}),s.scrollLeft=1e3*a,o._titleDOM.textContent=o.images[a].text,o._pagnationDOM.textContent=a+1+"/"+n;var i=o._dom.getElementsByClassName("image-browser__arrow-btn");0==a&&i[0].classList.add("image-browser__btn_disable"),a==n-1&&i[1].classList.add("image-browser__btn_disable")}},!1)}},toggleClose:function(){var e=this._dom;this.show?(this.show=!1,e.classList.remove("image-browser__show"),this.current=0):(this.show=!0,e.classList.add("image-browser__show"))},lazyLoadImage:function(e){var t=this.images[e];if(null!=t){var r=t.url,a=t.dom;"img"===a.nodeName.toLocaleLowerCase()&&null===a.getAttribute("src")&&a.setAttribute("src",r)}},init:function(){var e=d("div","image-browser");e.appendChild(this.createToolbar()),e.appendChild(this.createImageNav());var t=d("div","image-browser__pagnation");t.textContent="0/0",this._pagnationDOM=e.appendChild(t),this._dom=e,this.mount(document.body);var r=document.getElementsByClassName("ext")[0];this.showOnClick(r)},createToolbar:function(){var i=this,t=d("div","image-browser__row image-browser__toolbar"),e=d("div","image-browser__toolbar-item image-browser__toolbar-item_left"),r=d("button","image-browser__btn image-browser__rotate-btn");r.textContent="向左旋转",r.onclick=function(){c(i.images[i.current].dom,-90)},e.appendChild(r);var a=d("button","image-browser__btn image-browser__rotate-btn");a.textContent="向右旋转",a.onclick=function(){c(i.images[i.current].dom,90)},e.appendChild(a);var n=d("div","image-browser__toolbar-item image-browser__toolbar-item_center"),o=d("div","image-browser__title");o.textContent="文件名",this._titleDOM=n.appendChild(o);var s=d("div","image-browser__toolbar-item image-browser__toolbar-item_right"),l=d("button","image-browser__btn image-browser__download-btn");l.textContent="下载",l.onclick=function(){var e=i.images[i.current],a=e.text,t=e.url,n=new XMLHttpRequest;n.open("GET",t),n.responseType="blob",n.onload=function(e){var t=new Blob([n.response],{type:n.response.type}),r=new FileReader;r.onload=function(){var e=d("a");e.style.display="none",i._dom.appendChild(e),e.href=r.result,e.download=a,e.click(),i._dom.removeChild(e)},r.readAsDataURL(t)},n.send()},s.appendChild(l);var m=d("button","image-browser__btn image-browser__close-btn ion-ios-close-circle-outline");return m.onclick=this.toggleClose.bind(this),s.appendChild(m),[e,n,s].forEach(function(e){return t.appendChild(e)}),t},createImageNav:function(){var a=this,t=d("div","image-browser__row image-browser__image-nav"),n=d("div","image-browser__image-swiper"),e=function(e){var t=d("button","image-browser__btn image-browser__arrow-btn ion-ios-arrow-"+e);return t},r=e("back"),i=e("forward");[r,n,i].forEach(function(e){return t.appendChild(e)});var o=function(r){return function(){var e=a.images.length,t=(a.current+r+e)%e;n.scrollLeft=1e3*t,a._titleDOM.textContent=a.images[t].text,a._pagnationDOM.textContent=t+1+"/"+e,a.lazyLoadImage((t+r+e)%e),a.current=t}},s=o(-1),l=o(1);return r.onclick=s,i.onclick=l,t},createImgDOM:function(e){var t=e.src,r=e.index,a=d("img","image-browser__image");return a.setAttribute("alt",t),a.style="-webkit-transform:rotate(0);transform:rotate(0)",a.dataset.index=r,a},createUnknownFileTypeDOM:function(e){var t=d("div","image-browser__image-placeholder");return t.textContent="该文件不是图片，点击下载进行查看",t.dataset.index=e,t},insertImages:function(e){var i=this,o=this._dom.getElementsByClassName("image-browser__image-swiper")[0],s=["png","jpg","jpeg","gif","webp"];e.forEach(function(e,t){var r,a=s.includes((r=e.text,/[.]/.exec(r)?/[^.]+$/.exec(r)[0]:void 0).toLocaleLowerCase())?i.createImgDOM({src:e.url,index:t}):i.createUnknownFileTypeDOM(t),n=d("div","image-browser__image-wrapper");n.style.left=1e3*t+"px",n.appendChild(a),o.appendChild(n),e.dom=a})}};var r,a=(r=null,function(){return r||(r=new t)});e.init=a,e.showOnClick=function(e){a().showOnClick(e)}}(window.ImageBrowser={}),ImageBrowser.init();